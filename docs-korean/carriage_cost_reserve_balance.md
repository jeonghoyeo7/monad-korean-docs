# 운반 비용과 예비 잔액 (Carriage Cost and Reserve Balance)

## 배경

실행을 연기하는 것은 매우 강력합니다. 실행과 합의가 병렬로 수행될 수 있도록 하여 실행 시간 예산을 대폭 확장합니다.

분명한 반론은 다음과 같습니다: 합의 노드가 최신 상태를 갖고 있지 않다면, 모든 가스를 사용한 계정에서 트랜잭션을 잘못 포함하는 것을 어떻게 방지할 수 있을까요? 이는 서비스 거부(DoS) 벡터를 생성할 수 있습니다.

이를 방지하기 위해, 모나드는 네트워크를 통해 트랜잭션을 전송하는 비용(“운반 비용”, Carriage Cost)을 도입하고, 각 계정에 대해 합의 시간에 업데이트되는 예비 잔액을 유지하며, 운반 비용을 예비 잔액에서 차감합니다.

## 운반 비용

모나드에서는 네트워크를 통해 블록에서 트랜잭션을 전송하는 비용(“운반 비용”)이 부과됩니다. 이는 실행 비용과는 별개의 비용입니다.

운반 비용은 스팸 방지를 위해 필요합니다. 비용은 최소한이지만 네트워크 자원을 사용하는 비용을 반영합니다.

트랜잭션이 합의에 포함되어 운반 비용이 부과되지만 지정된 가스 한도에 비해 실행 예산이 부족할 수 있습니다. 이 경우 실행 시점에 트랜잭션은 실패하지만 실패 시점까지 가스가 부과됩니다. 이는 이더리움과 다르지 않습니다: 계정에 충분한 이더가 없는 트랜잭션은 이더를 소모하고 실패합니다. 실패 시점까지 가스를 부과하는 것은 실행 DoS 벡터를 방지하기 위해 필요합니다.

## 예비 잔액

각 주소에 대해 노드는 두 가지 잔액을 유지합니다:

- **예비 잔액**: 운반 비용을 지불하는 데 사용됩니다.
- **실행 잔액**: 트랜잭션 실행 비용을 지불하는 데 사용됩니다.

운반 비용은 트랜잭션이 블록에 포함될 때(합의) 예비 잔액에서 차감됩니다. 실행 시점에 실행 잔액에서 차감되고, 지연 기간 `D` 블록(10초)이 지나면 예비 잔액에 환급됩니다.

예비 잔액은 “비행 중” 주문의 예산입니다. 이는 지불된 트랜잭션만 블록에 포함되도록 보장합니다. 예비 잔액은 실시간으로 감소하는 것으로 생각할 수 있습니다. 노드의 전체 상태에 대한 관점이 지연되더라도 예비 잔액은 항상 최신 지출을 반영합니다.

## 목표 예비 잔액

목표 예비 잔액은 계정별 매개변수입니다. 기본값은 운반 비용의 큰 배수(200배)로 예상되어 사용자가 많은 수의 비행 중 주문을 문제없이 제출할 수 있도록 합니다.

동일한 EOA에서 많은 수의 비행 중 주문을 보내는 사용자는 내장된 스마트 계약과 상호 작용하여 목표 예비 잔액을 변경할 수 있습니다. 예비 잔액 변경은 실행으로 처리되며, 지연 기간이 지나야 예비 잔액에 반영됩니다.
